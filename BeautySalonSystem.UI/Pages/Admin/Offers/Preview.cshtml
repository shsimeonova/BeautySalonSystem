@page
@model BeautySalonSystem.UI.Pages.Admin.Offers.Preview

@{
    ViewData["Title"] = "Preview Offer";
    var selectedIds = Model.CreateOfferInput.ProductIds;
}

<header class="masthead-admin bg-primary text-white text-center">
    <div class="masthead-admin-container d-flex align-items-center flex-column">
        <h1 class="masthead-heading text-uppercase mb-0 text-white">Прегледай</h1>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-leaf"></i></div>
            <div class="divider-custom-line"></div>
        </div>
        <!-- Masthead Subheading-->
        <p class="masthead-subheading font-weight-light mb-0"></p>
    </div>
</header>

<div class="container align-content-center admin-products-actions">
  <a class="btn btn-default" href="@Url.Page("/Admin/Offers/Create")"><i class="fas fa-chevron-left"></i> Обратно</a>
</div>

<div class="container col-6">
    <form method="post" onsubmit="removeSelectedProductsDisabled()">
        <div class="form-group">
            <label asp-for="@Model.CreateOfferInput.Name" class="col-form-label col-md-4">Име</label>
            <input type="text" class="form-control" asp-for="@Model.CreateOfferInput.Name">
        </div>
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <select id="items-select" asp-items="@Model.Products" asp-for="@Model.CreateOfferInput.ProductIds" class="selectpicker form-control" multiple disabled></select>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label asp-for="@Model.CreateOfferInput.TotalPrice" class="col-form-label col-md-4">Обща цена</label>
            <input type="text" id="preview-total-price" class="form-control" asp-for="@Model.CreateOfferInput.TotalPrice">
        </div>
        <div class="form-group">
            <label asp-for="@Model.CreateOfferInput.ExpiryDate" class="col-form-label col-md-3">Активна до:</label>
            <input type="date" class="form-control datetime-local" asp-for="@Model.CreateOfferInput.ExpiryDate">
        </div>
        <input type="hidden" id="total-price-default" value="@Model.CreateOfferInput.TotalPrice">
        <div class="form-group">
            <label asp-for="@Model.CreateOfferInput.Discount" class="col-form-label col-md-4" id="discount-label">Отстъпка</label>
            <input type="number" class="form-control" asp-for="@Model.CreateOfferInput.Discount" onchange="updateTotalPrice(this)">
        </div>
        <script type="text/javascript">
          function updateTotalPrice(discount) {
            var discountValue = Number(discount.value);
            
            var totalPrice = Number(document.getElementById('total-price-default').value);
            var totalPriceInput = document.getElementById('preview-total-price');
            var calculatedDiscount = 0;
            
            if (discountValue !== 0) {
                document.getElementById('total-price-default').value;
                calculatedDiscount = (discountValue / 100) * totalPrice;
                totalPrice = totalPrice - (calculatedDiscount);
                totalPriceInput.value = totalPrice;
            }
            document.getElementById('discount-label').innerHTML = "Отстъпка (" + calculatedDiscount + "лв)";
          }
          
          function removeSelectedProductsDisabled() {
              document.getElementById('items-select').disabled = false;
          }
        </script>
        <div class="form-group">
            <button class="btn btn btn-success">Потвърди</button>
        </div>
    </form>
</div>